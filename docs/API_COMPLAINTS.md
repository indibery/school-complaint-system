# ğŸ« ë¯¼ì› ê´€ë¦¬ ì‹œìŠ¤í…œ API ë¬¸ì„œ

## ğŸ“‹ ê°œìš”

í•™êµ ë¯¼ì› ê´€ë¦¬ ì‹œìŠ¤í…œì˜ RESTful API ë¬¸ì„œì…ë‹ˆë‹¤. í•™ë¶€ëª¨, êµì‚¬, ê´€ë¦¬ì ê°„ì˜ ë¯¼ì› ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

## ğŸ” ì¸ì¦

ëª¨ë“  APIëŠ” JWT í† í° ê¸°ë°˜ ì¸ì¦ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```http
Authorization: Bearer <JWT_TOKEN>
```

## ğŸ¯ ê¸°ë³¸ ì •ë³´

- **Base URL**: `http://localhost:3000/api`
- **Content-Type**: `application/json`
- **API Version**: `v1.0.0`

## ğŸ‘¥ ì‚¬ìš©ì ê¶Œí•œ

| ê¶Œí•œ | ì„¤ëª… | ì ‘ê·¼ ê°€ëŠ¥ API |
|------|------|---------------|
| `parent` | í•™ë¶€ëª¨ | ë³¸ì¸ ë¯¼ì› CRUD |
| `teacher` | êµì‚¬ | ëª¨ë“  ë¯¼ì› ì¡°íšŒ, ìƒíƒœ ë³€ê²½ |
| `admin` | ê´€ë¦¬ì | ëª¨ë“  ê¸°ëŠ¥ |
| `security` | êµë¬¸ ê´€ë¦¬ì | ê¸°ë³¸ ì¡°íšŒ |

## ğŸ“ ë¯¼ì› ìƒíƒœ

| ìƒíƒœ | ì„¤ëª… |
|------|------|
| `submitted` | ì ‘ìˆ˜ë¨ |
| `in_progress` | ì²˜ë¦¬ì¤‘ |
| `resolved` | í•´ê²°ë¨ |
| `closed` | ì¢…ë£Œë¨ |

## ğŸ“Š ë¯¼ì› ì¹´í…Œê³ ë¦¬

| ì¹´í…Œê³ ë¦¬ | ì„¤ëª… |
|----------|------|
| `facility` | ì‹œì„¤ ê´€ë ¨ |
| `meal` | ê¸‰ì‹ ê´€ë ¨ |
| `safety` | ì•ˆì „ ê´€ë ¨ |
| `education` | êµìœ¡ ê´€ë ¨ |
| `administration` | í–‰ì • ê´€ë ¨ |
| `bullying` | ê´´ë¡­í˜ ê´€ë ¨ |
| `academic` | í•™ì—… ê´€ë ¨ |
| `other` | ê¸°íƒ€ |

---

## ğŸ“‹ API ì—”ë“œí¬ì¸íŠ¸

### 1. ë¯¼ì› ë“±ë¡

í•™ë¶€ëª¨ê°€ ìƒˆë¡œìš´ ë¯¼ì›ì„ ë“±ë¡í•©ë‹ˆë‹¤.

**POST** `/complaints`

#### ìš”ì²­ ê¶Œí•œ
- `parent`, `teacher`, `admin`

#### ìš”ì²­ ë³¸ë¬¸
```json
{
  "title": "ê¸‰ì‹ ê´€ë ¨ ë¯¼ì›",
  "description": "ê¸‰ì‹ì˜ ì§ˆì´ ì¢‹ì§€ ì•Šì•„ì„œ ê°œì„ ì„ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.",
  "category": "meal",
  "priority": "medium",
  "anonymous": false
}
```

#### í•„ìˆ˜ í•„ë“œ
- `title` (string, 5-200ì): ë¯¼ì› ì œëª©
- `description` (string, 10-2000ì): ë¯¼ì› ë‚´ìš©
- `category` (string): ë¯¼ì› ì¹´í…Œê³ ë¦¬

#### ì„ íƒ í•„ë“œ
- `priority` (string): ìš°ì„ ìˆœìœ„ (ê¸°ë³¸ê°’: "medium")
- `anonymous` (boolean): ìµëª… ì—¬ë¶€ (ê¸°ë³¸ê°’: false)

#### ì„±ê³µ ì‘ë‹µ (201)
```json
{
  "success": true,
  "message": "ë¯¼ì›ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "complaint": {
      "id": 123,
      "title": "ê¸‰ì‹ ê´€ë ¨ ë¯¼ì›",
      "description": "ê¸‰ì‹ì˜ ì§ˆì´ ì¢‹ì§€ ì•Šì•„ì„œ ê°œì„ ì„ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.",
      "category": "meal",
      "status": "submitted",
      "priority": "medium", 
      "anonymous": false,
      "created_at": "2025-06-29T10:30:00Z",
      "updated_at": "2025-06-29T10:30:00Z"
    }
  }
}
```

#### ì˜¤ë¥˜ ì‘ë‹µ
- `400`: ì…ë ¥ ë°ì´í„° ì˜¤ë¥˜
- `401`: ì¸ì¦ í•„ìš”
- `500`: ì„œë²„ ì˜¤ë¥˜

---

### 2. ë¯¼ì› ëª©ë¡ ì¡°íšŒ

ê¶Œí•œì— ë”°ë¼ ë¯¼ì› ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

**GET** `/complaints`

#### ìš”ì²­ ê¶Œí•œ
- `parent`: ë³¸ì¸ ë¯¼ì›ë§Œ
- `teacher`, `admin`: ëª¨ë“  ë¯¼ì›

#### ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°
```http
GET /complaints?page=1&limit=10&category=meal&status=submitted&search=ê¸‰ì‹&sort=created_at&order=desc
```

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|------|--------|
| `page` | number | í˜ì´ì§€ ë²ˆí˜¸ | 1 |
| `limit` | number | í˜ì´ì§€ í¬ê¸° (1-100) | 10 |
| `category` | string | ì¹´í…Œê³ ë¦¬ í•„í„° | - |
| `status` | string | ìƒíƒœ í•„í„° | - |
| `priority` | string | ìš°ì„ ìˆœìœ„ í•„í„° | - |
| `search` | string | ì œëª©/ë‚´ìš© ê²€ìƒ‰ | - |
| `anonymous` | boolean | ìµëª… ì—¬ë¶€ í•„í„° | - |
| `sort` | string | ì •ë ¬ í•„ë“œ | created_at |
| `order` | string | ì •ë ¬ ìˆœì„œ (asc/desc) | desc |

#### ì„±ê³µ ì‘ë‹µ (200)
```json
{
  "success": true,
  "message": "ë¯¼ì› ëª©ë¡ ì¡°íšŒ ì„±ê³µ",
  "data": {
    "complaints": [
      {
        "id": 123,
        "title": "ê¸‰ì‹ ê´€ë ¨ ë¯¼ì›",
        "description": "ê¸‰ì‹ì˜ ì§ˆì´ ì¢‹ì§€ ì•Šì•„ì„œ...",
        "category": "meal",
        "status": "submitted",
        "priority": "medium",
        "anonymous": false,
        "user_name": "ê¹€í•™ë¶€ëª¨",
        "user_email": "parent@example.com",
        "assigned_name": null,
        "created_at": "2025-06-29T10:30:00Z",
        "updated_at": "2025-06-29T10:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 25,
      "totalPages": 3
    },
    "filters": {
      "category": "meal",
      "status": "submitted",
      "search": "ê¸‰ì‹"
    }
  }
}
```

---

### 3. ë¯¼ì› ìƒì„¸ ì¡°íšŒ

íŠ¹ì • ë¯¼ì›ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

**GET** `/complaints/:id`

#### ìš”ì²­ ê¶Œí•œ
- `parent`: ë³¸ì¸ ë¯¼ì›ë§Œ
- `teacher`, `admin`: ëª¨ë“  ë¯¼ì›

#### ê²½ë¡œ íŒŒë¼ë¯¸í„°
- `id` (number): ë¯¼ì› ID

#### ì„±ê³µ ì‘ë‹µ (200)
```json
{
  "success": true,
  "message": "ë¯¼ì› ìƒì„¸ ì¡°íšŒ ì„±ê³µ",
  "data": {
    "complaint": {
      "id": 123,
      "title": "ê¸‰ì‹ ê´€ë ¨ ë¯¼ì›",
      "description": "ê¸‰ì‹ì˜ ì§ˆì´ ì¢‹ì§€ ì•Šì•„ì„œ...",
      "category": "meal",
      "status": "in_progress",
      "priority": "medium",
      "anonymous": false,
      "response": "í˜„ì¬ ì¡°ì‚¬ ì¤‘ì…ë‹ˆë‹¤.",
      "created_at": "2025-06-29T10:30:00Z",
      "updated_at": "2025-06-29T11:00:00Z",
      "resolved_at": null,
      "user": {
        "id": 456,
        "name": "ê¹€í•™ë¶€ëª¨",
        "email": "parent@example.com"
      },
      "assigned_to": {
        "id": 789,
        "name": "ë°•ì„ ìƒë‹˜"
      },
      "attachments": [
        {
          "id": 1,
          "filename": "ê¸‰ì‹ì‚¬ì§„.jpg",
          "size": 1024000,
          "type": "image/jpeg",
          "uploaded_at": "2025-06-29T10:35:00Z"
        }
      ],
      "comments": [
        {
          "id": 1,
          "content": "ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.",
          "is_internal": false,
          "created_at": "2025-06-29T11:00:00Z",
          "user": {
            "name": "ë°•ì„ ìƒë‹˜",
            "role": "teacher"
          }
        }
      ]
    }
  }
}
```

#### ì˜¤ë¥˜ ì‘ë‹µ
- `400`: ì˜ëª»ëœ ID í˜•ì‹
- `404`: ë¯¼ì› ì—†ìŒ ë˜ëŠ” ê¶Œí•œ ì—†ìŒ

---

### 4. ë¯¼ì› ìˆ˜ì •

ë³¸ì¸ì˜ ë¯¼ì›ì„ ìˆ˜ì •í•©ë‹ˆë‹¤ (submitted ìƒíƒœë§Œ).

**PUT** `/complaints/:id`

#### ìš”ì²­ ê¶Œí•œ
- `parent`: ë³¸ì¸ ë¯¼ì›ë§Œ (submitted ìƒíƒœë§Œ)

#### ê²½ë¡œ íŒŒë¼ë¯¸í„°
- `id` (number): ë¯¼ì› ID

#### ìš”ì²­ ë³¸ë¬¸
```json
{
  "title": "ìˆ˜ì •ëœ ê¸‰ì‹ ê´€ë ¨ ë¯¼ì›",
  "description": "ìˆ˜ì •ëœ ë¯¼ì› ë‚´ìš©",
  "category": "safety",
  "priority": "high",
  "anonymous": true
}
```

#### ë¶€ë¶„ ìˆ˜ì • ì§€ì›
ì¼ë¶€ í•„ë“œë§Œ ì „ì†¡í•´ë„ í•´ë‹¹ í•„ë“œë§Œ ìˆ˜ì •ë©ë‹ˆë‹¤.

```json
{
  "title": "ì œëª©ë§Œ ìˆ˜ì •"
}
```

#### ì„±ê³µ ì‘ë‹µ (200)
```json
{
  "success": true,
  "message": "ë¯¼ì›ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "complaint": {
      "id": 123,
      "title": "ìˆ˜ì •ëœ ê¸‰ì‹ ê´€ë ¨ ë¯¼ì›",
      "description": "ìˆ˜ì •ëœ ë¯¼ì› ë‚´ìš©",
      "category": "safety",
      "status": "submitted",
      "priority": "high",
      "anonymous": true,
      "created_at": "2025-06-29T10:30:00Z",
      "updated_at": "2025-06-29T12:00:00Z"
    }
  }
}
```

#### ì˜¤ë¥˜ ì‘ë‹µ
- `400`: ìˆ˜ì •í•  ë°ì´í„° ì—†ìŒ
- `403`: ì²˜ë¦¬ ì¤‘ì¸ ë¯¼ì› ìˆ˜ì • ë¶ˆê°€
- `404`: ë¯¼ì› ì—†ìŒ ë˜ëŠ” ê¶Œí•œ ì—†ìŒ

---

### 5. ë¯¼ì› ì‚­ì œ (ì†Œí”„íŠ¸ ì‚­ì œ)

ë³¸ì¸ì˜ ë¯¼ì›ì„ ì‚­ì œí•©ë‹ˆë‹¤ (submitted ìƒíƒœë§Œ).

**DELETE** `/complaints/:id`

#### ìš”ì²­ ê¶Œí•œ
- `parent`: ë³¸ì¸ ë¯¼ì›ë§Œ (submitted ìƒíƒœë§Œ)

#### ê²½ë¡œ íŒŒë¼ë¯¸í„°
- `id` (number): ë¯¼ì› ID

#### ì„±ê³µ ì‘ë‹µ (200)
```json
{
  "success": true,
  "message": "ë¯¼ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "complaint": {
      "id": 123,
      "status": "closed",
      "deleted_at": "2025-06-29T13:00:00Z"
    }
  }
}
```

#### ì°¸ê³ ì‚¬í•­
- ë¬¼ë¦¬ì  ì‚­ì œê°€ ì•„ë‹Œ ìƒíƒœë¥¼ 'closed'ë¡œ ë³€ê²½í•˜ëŠ” ì†Œí”„íŠ¸ ì‚­ì œ
- ë°ì´í„° ë³µêµ¬ ë° ê°ì‚¬ ì¶”ì  ê°€ëŠ¥

---

### 6. ë¯¼ì› ìƒíƒœ ë³€ê²½

êµì‚¬/ê´€ë¦¬ìê°€ ë¯¼ì› ìƒíƒœë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.

**PATCH** `/complaints/:id/status`

#### ìš”ì²­ ê¶Œí•œ
- `teacher`, `admin`

#### ê²½ë¡œ íŒŒë¼ë¯¸í„°
- `id` (number): ë¯¼ì› ID

#### ìš”ì²­ ë³¸ë¬¸
```json
{
  "status": "in_progress",
  "assigned_to": 789,
  "response": "ì²˜ë¦¬ë¥¼ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤."
}
```

#### í•„ìˆ˜ í•„ë“œ
- `status` (string): ìƒˆë¡œìš´ ìƒíƒœ

#### ì„ íƒ í•„ë“œ
- `assigned_to` (number): ë‹´ë‹¹ì ID
- `response` (string): ì²˜ë¦¬ ì‘ë‹µ ë©”ì‹œì§€

#### ìƒíƒœ ì „í™˜ í”Œë¡œìš°
```
submitted â†’ in_progress â†’ resolved â†’ closed
```

#### ì„±ê³µ ì‘ë‹µ (200)
```json
{
  "success": true,
  "message": "ë¯¼ì› ìƒíƒœê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "complaint": {
      "id": 123,
      "status": "resolved",
      "assigned_to": 789,
      "response": "ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.",
      "updated_at": "2025-06-29T14:00:00Z",
      "resolved_at": "2025-06-29T14:00:00Z"
    }
  }
}
```

#### ì˜¤ë¥˜ ì‘ë‹µ
- `400`: ì˜ëª»ëœ ìƒíƒœê°’
- `403`: ê¶Œí•œ ì—†ìŒ
- `404`: ë¯¼ì› ì—†ìŒ

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ìµëª… ë¯¼ì› ì²˜ë¦¬
- ìµëª… ë¯¼ì›ì˜ ê²½ìš° ì‘ì„±ì ì •ë³´ ë§ˆìŠ¤í‚¹
- í•™ë¶€ëª¨ì—ê²ŒëŠ” ì‘ì„±ì ì •ë³´ ìˆ¨ê¹€
- êµì‚¬/ê´€ë¦¬ìëŠ” ì‹¤ì œ ì‘ì„±ì í™•ì¸ ê°€ëŠ¥

### 2. ê¶Œí•œë³„ ì ‘ê·¼ ì œì–´
- í•™ë¶€ëª¨: ë³¸ì¸ ë¯¼ì›ë§Œ ì ‘ê·¼
- êµì‚¬: ëª¨ë“  ë¯¼ì› ì¡°íšŒ ë° ìƒíƒœ ë³€ê²½
- ê´€ë¦¬ì: ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼

### 3. ë°ì´í„° ë³´í˜¸
- ë¯¼ê° ì •ë³´ ì‘ë‹µì—ì„œ ì œì™¸
- ì†Œí”„íŠ¸ ì‚­ì œë¡œ ë°ì´í„° ë³´ì¡´
- ë³€ê²½ ì´ë ¥ ì¶”ì 

---

## ğŸ“Š HTTP ìƒíƒœ ì½”ë“œ

| ì½”ë“œ | ì„¤ëª… |
|------|------|
| 200 | ì„±ê³µ |
| 201 | ìƒì„± ì„±ê³µ |
| 400 | ì˜ëª»ëœ ìš”ì²­ |
| 401 | ì¸ì¦ í•„ìš” |
| 403 | ê¶Œí•œ ì—†ìŒ |
| 404 | ë¦¬ì†ŒìŠ¤ ì—†ìŒ |
| 409 | ì¶©ëŒ (ì¤‘ë³µ ë“±) |
| 500 | ì„œë²„ ì˜¤ë¥˜ |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸
npm test

# ë¯¼ì› API í…ŒìŠ¤íŠ¸ë§Œ
npm test -- --testNamePattern="ë¯¼ì›"

# ì»¤ë²„ë¦¬ì§€ í¬í•¨ í…ŒìŠ¤íŠ¸
npm run test:coverage
```

### í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
- API ì—”ë“œí¬ì¸íŠ¸: 100%
- ê¶Œí•œ ì‹œë‚˜ë¦¬ì˜¤: 100%
- ì—ëŸ¬ ì²˜ë¦¬: 95% ì´ìƒ

---

## ğŸ“ ë³€ê²½ ì´ë ¥

### v1.0.0 (2025-06-29)
- ì´ˆê¸° ë¯¼ì› ê´€ë¦¬ API êµ¬í˜„
- CRUD ê¸°ëŠ¥ ì™„ì„±
- ê¶Œí•œë³„ ì ‘ê·¼ ì œì–´
- í…ŒìŠ¤íŠ¸ ì½”ë“œ ì™„ë¹„

---

## ğŸ›  ê°œë°œ ì •ë³´

- **ê°œë°œì**: Claude + ì‚¬ìš©ì
- **ê°œë°œ ë„êµ¬**: VS Code + Desktop Commander
- **í”„ë ˆì„ì›Œí¬**: Node.js + Express.js
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL
- **í…ŒìŠ¤íŠ¸**: Jest + Supertest
- **ì¸ì¦**: JWT

---

## ğŸ“ ì§€ì›

ë¬¸ì˜ì‚¬í•­ì´ë‚˜ ë²„ê·¸ ë¦¬í¬íŠ¸ëŠ” í”„ë¡œì íŠ¸ ì´ìŠˆ íŠ¸ë˜ì»¤ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.

**API ë¬¸ì„œ ë²„ì „**: 1.0.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-06-29